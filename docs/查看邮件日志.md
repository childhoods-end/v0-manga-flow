# 如何查看 Supabase 邮件发送日志

## 方法 1：在 Logs & Analytics 中查询

你现在已经在正确的位置了！请按以下步骤操作：

### 步骤 1：修改查询语句

将当前的查询改为：

```sql
select
  cast(timestamp as datetime) as datetime,
  event_message,
  metadata
from auth_audit_logs
where event_message ilike '%email%'
  or event_message ilike '%smtp%'
  or event_message ilike '%mail%'
order by timestamp desc
limit 50
```

### 步骤 2：点击 "Run" 按钮（绿色按钮）

### 步骤 3：查看结果中的关键信息

重点看：
- `event_message` 列：查找包含 "email sent" 或 "email failed" 的记录
- `metadata` 列：展开查看详细信息，找 `provider` 字段

## 方法 2：查看 Edge Functions 日志（如果有邮件发送函数）

1. 左侧菜单 → **Edge Functions**
2. 查看最近的执行日志
3. 看有没有邮件发送相关的错误

## 方法 3：检查 SMTP 配置状态

既然日志查看比较复杂，我们直接测试配置是否生效：

### 快速测试步骤：

1. **确认 SMTP 开关状态**
   - 左侧菜单 → 齿轮图标（Settings）→ **Authentication**
   - 向下滚动找到 **SMTP Settings**
   - 确认 "Enable Custom SMTP" 是 **ON（开启状态，蓝色）**

2. **使用真实注册测试**
   - 访问你的网站：`https://your-project.vercel.app/auth`
   - 用一个全新的邮箱注册（从未注册过的）
   - 注册后立即检查邮箱（收件箱 + 垃圾箱）

3. **检查 Authentication Users**
   - Supabase Dashboard → 左侧 **Authentication** → **Users**
   - 看看刚才注册的用户是否出现
   - 用户状态是什么（Confirmed / Unconfirmed）

## 最可能的问题

根据 "接口成功但收不到邮件" 的情况，90% 是以下原因之一：

### ❌ 问题 1：Custom SMTP 未启用

**症状**：API 返回成功，但实际用的是 Supabase 默认邮件服务（有严格频率限制）

**检查方法**：
- Settings → Authentication → SMTP Settings
- 确认 "Enable Custom SMTP" 开关是 **ON（蓝色）**

**解决方案**：
- 如果是 OFF → 开启
- 点击 Save
- 等待 30 秒让配置生效

### ❌ 问题 2：Gmail SMTP 密码有空格

**症状**：配置保存了，但后台认证失败

**解决方案**：
1. 重新获取 Gmail 应用专用密码：https://myaccount.google.com/apppasswords
2. 复制密码后，粘贴到记事本
3. 删除所有空格（原始格式：`abcd efgh ijkl mnop` → 去空格：`abcdefghijklmnop`）
4. 回到 Supabase SMTP Settings
5. 清空 SMTP Password 字段（Ctrl+A → Delete）
6. 粘贴无空格密码
7. 点击 Save

### ❌ 问题 3：邮件在垃圾箱

**检查步骤**：
1. 打开 Gmail 垃圾邮件文件夹
2. 搜索 "MangaFlow" 或你的发件邮箱
3. 检查促销邮件标签页

## 快速解决方案：临时禁用邮箱验证

如果你急需让系统先工作起来：

1. Supabase Dashboard → Settings → Authentication
2. 找到 **Email** 提供商
3. **关闭** "Confirm email" 选项
4. 保存

**效果**：用户注册后直接可以登录，无需验证邮箱

⚠️ 这只是临时方案，生产环境建议开启验证

## 需要的信息

为了精确定位问题，请提供：

1. **SMTP 开关状态**
   - Settings → Authentication → SMTP Settings
   - "Enable Custom SMTP" 是 ON 还是 OFF？

2. **测试结果**
   - 用真实注册测试后，邮箱有收到吗？
   - 在 Authentication → Users 中能看到新用户吗？
   - 用户状态是 Confirmed 还是 Unconfirmed？

3. **邮件位置**
   - 收件箱：有 ❌
   - 垃圾箱：有 ❌
   - 促销标签：有 ❌
   - 完全没收到：❌
